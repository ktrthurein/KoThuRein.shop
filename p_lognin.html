<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Ko Thu Rein Shop - Auth</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <style>
    /* your existing CSS remains unchanged */
    /* ... copy your CSS code from before ... */
  </style>
</head>
<body>
  <!-- Clouds -->
  <div class="cloud"></div>
  <div class="cloud"></div>
  <div class="cloud"></div>

  <!-- Auth UI -->
  <div class="auth-box" id="authBox">
    <h2 id="form-title">Login</h2>
    <div id="username-group" class="input-group">
      <label>Username</label>
      <input type="text" id="username" placeholder="Username">
    </div>
    <div class="input-group">
      <label>Phone Number</label>
      <input type="tel" id="phone" placeholder="+959XXXXXXXXX">
    </div>
    <div class="input-group">
      <label>Password</label>
      <input type="password" id="password" placeholder="Password">
    </div>
    <button class="auth-btn" onclick="handleAuth()">Login</button>
    <div class="toggle-text">
      <span id="toggle-msg">Don’t have an account?</span>
      <a onclick="toggleMode()">Sign up</a> | 
      <a onclick="resetPassword()">Forgot?</a>
    </div>
  </div>

  <div class="dots">
    <span></span><span></span><span></span><span></span>
  </div>
  <div class="success-popup" id="successPopup">Login Success! Welcome!</div>

  <script>
    const supabaseUrl = 'https://pacysfkupxmlhodllugx.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBhY3lzZmt1cHhtbGhvZGxsdWd4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ5MzI2OTksImV4cCI6MjA2MDUwODY5OX0.p115vzQXI30SCw9rafkY1vBMC0ugwFUUp3Mdf_kcVqk';
    const supabase = supabase.createClient(supabaseUrl, supabaseKey);

    let isLogin = true;

    function toggleMode() {
      const title = document.getElementById("form-title");
      const usernameGroup = document.getElementById("username-group");
      const btn = document.querySelector(".auth-btn");
      const msg = document.getElementById("toggle-msg");
      const link = document.querySelector(".toggle-text a");

      if (isLogin) {
        title.textContent = "Sign Up";
        usernameGroup.style.display = "block";
        btn.textContent = "Sign Up";
        msg.textContent = "Already have an account?";
        link.textContent = "Login";
        isLogin = false;
      } else {
        title.textContent = "Login";
        usernameGroup.style.display = "none";
        btn.textContent = "Login";
        msg.textContent = "Don’t have an account?";
        link.textContent = "Sign up";
        isLogin = true;
      }
    }

    async function handleAuth() {
      const phone = document.getElementById('phone').value;
      const password = document.getElementById('password').value;
      const username = document.getElementById('username').value;

      if (!phone || !password) {
        alert("Please fill in all fields.");
        return;
      }

      const email = phone + "@ktr.fake"; // Supabase uses email, so fake email from phone
      if (isLogin) {
        const { data, error } = await supabase.auth.signInWithPassword({
          email, password
        });
        if (error) return alert("Login error: " + error.message);
      } else {
        const { data, error } = await supabase.auth.signUp({
          email, password,
          options: {
            data: { username, phone }
          }
        });
        if (error) return alert("Sign up error: " + error.message);
      }

      const popup = document.getElementById("successPopup");
      popup.style.display = "block";
      setTimeout(() => popup.style.display = "none", 2000);
    }

    async function resetPassword() {
      const phone = prompt("Enter your phone number:");
      if (!phone) return;

      const email = phone + "@ktr.fake";
      const { data, error } = await supabase.auth.resetPasswordForEmail(email);
      if (error) {
        alert("Reset error: " + error.message);
      } else {
        alert("Password reset link sent to your email (check spam too): " + email);
      }
    }
  </script>
</body>
</html>
